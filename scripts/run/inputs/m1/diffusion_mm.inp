<comment> # ===================================================================
# additional comments (such as e.g. compilation parameters go here)
# ...
# =============================================================================

<job> # =======================================================================
problem_id = diffusion_mm
# =============================================================================

<time> # ======================================================================
cfl_number   = 0.625
tlim	       = 4
ncycle_out   = 1      # interval for stdout summary info
# =============================================================================

<mesh> # ======================================================================
# no. cell in dir, min/max x, inner/outer BC
nx1    = 200
x1min  = -4
x1max  = 4
ix1_bc = outflow
ox1_bc = outflow

nx2    = 4
x2min  = -0.02
x2max  = 0.02
ix2_bc = periodic
ox2_bc = periodic

nx3    = 4
x3min  = -0.02
x3max  = 0.02
ix3_bc = periodic
ox3_bc = periodic

refinement = none
num_threads = 10
# =============================================================================

<meshblock> # =================================================================
nx1 = 20
nx2 = 4
nx3 = 4
# =============================================================================

<M1> # ========================================================================
ngroups  = 1
nspecies = 1

# element of:
# {thin,
#  thick,
#  Minerbo,    - Brent-Dekker (GSL based)
#  MinerboP    - Picard
#  MinerboN    - Newton-Raphson
# }
closure_variety = Minerbo

# element of: {approximate, exact_thin, exact_thick, exact_Minerbo}
characteristics_variety = approximate

# element of: {fluid, mixed, zero, none}
fiducial_velocity = fluid

# element of:
# {full_explicit,                - non-stiff regime
#  semi_implicit_PicardFrozenP   - only for fixed (P_dd)
#  semi_implicit_PicardMinerboP  - updates P_dd based on Minerbo;
#                                  Closure is iterated as part of imp.
#  semi_implicit_PicardMinerboPC - close explicit iter; iter; close conv.
# }
integration_strategy = semi_implicit_PicardMinerboP

# tolerances / ad-hoc fiddle parameters
fl_E = 1e-15
fl_J = 1e-15
eps_E = 1e-5
eps_J = 1e-10
min_flux_A = 0

# [Minerbo] closure root tolerance & maximum iterations
eps_C          = 1e-8
eps_C_N        = 1e-10  // switch to Picard if deriv. below this
max_iter_C     = 128
max_iter_C_rst = 10
w_opt_ini_C    = 1.0
fac_amp_C      = 1.20  // error amplification tolerance between iterates
reset_thin     = true  // reset on failure to thin limit
verbose_iter_C = false

# [Picard] iteration settings
max_iter_P     = 512  // maximum number of iterations (for each restart)
max_iter_P_rst = 15    // maximum number of restarts
w_opt_ini_P    = 1.0   // initial underrelaxation factor
eps_P_abs_tol  = 1e-8  // absolute tolerance
fac_amp_P      = 1.20  // error amplification tolerance between iterates
verbose_iter_P = false  // signal e.g. failure to achieve tol.

# =============================================================================

<M1_opacities> # ==============================================================
# element of: {zero, none}
variety = none
# =============================================================================

<problem> # ===================================================================
test = diffusion_moving_medium

rho   = 1.0
kap_s = 1000
abs_v = 0.5   # magnitude of fiducial vel.
# =============================================================================

<refinement1> # ===============================================================
x1min =  -0.2
x1max =  0.2
x2min = -1.0
x2max = -1.0
x3min = -1.0
x3max =  1.0
level = 2
# =============================================================================

# dumped quantities ===========================================================
# <output1>
# file_type = rst
# dt        = 1

<output2>
file_type   = hdf5
variable    = m1_lab
dt          = 0.1
ghost_zones = true

<output2>
file_type   = hdf5
variable    = m1_lab
dt          = 0.1
ghost_zones = true
x2_slice    = 0.0
x3_slice    = 0.0

<output3>
file_type   = hdf5
variable    = m1_lab_aux
dt          = 0.1
ghost_zones = true
x2_slice    = 0.0
x3_slice    = 0.0

#
# :D
#